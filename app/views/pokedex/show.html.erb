<% if @pokemon.present? %>
  <div class="container py-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
      <%= link_to '← Back to Pokédex', root_path, class: "btn btn-outline-secondary" %>
      <div>
        <% prev_id = @pokemon.pokeapi_id - 1 %>
        <% next_id = @pokemon.pokeapi_id + 1 %>

        <% if prev_id > 0 %>
          <%= link_to "← #{prev_id}", pokedex_path(prev_id), class: "btn btn-outline-primary me-2" %>
        <% end %>

        <% if next_id <= 151 %>
          <%= link_to "#{next_id} →", pokedex_path(next_id), class: "btn btn-outline-primary" %>
        <% end %>
      </div>
    </div>

    <div class="text-center">
      <% main_type = @pokemon.types.first %> 
      <h1 class="text-capitalize fw-bold" style="color: <%= type_color(main_type) %>;">
        <%= @pokemon.name %> <small class="text-muted">#<%= @pokemon.pokeapi_id %></small>
      </h1>

      <% if @pokemon.flavor_text.present? %>
        <p class="fst-italic text-muted"><%= @pokemon.flavor_text %></p>
      <% else %>
        <p class="text-muted">No description available.</p>
      <% end %>

      <img src="<%= @pokemon.image_url %>"
           alt="<%= @pokemon.name %>"
           class="img-fluid mb-4"
           style="max-height: 250px;" />

      <p><strong>Height:</strong> <%= @pokemon.height %> dm</p>
      <p><strong>Weight:</strong> <%= @pokemon.weight %> hg</p>
      <p><strong>Base Experience:</strong> <%= @pokemon.base_experience %></p>

      <p><strong>Types:</strong>
        <% @pokemon.types.each do |type| %>
          <span class="badge bg-primary text-capitalize me-1"><%= type %></span>
        <% end %>
      </p>
    </div>

    <div class="mt-5">
      <h4 class="mb-3">Base Stats</h4>
      <ul class="list-group">
        <% @pokemon.stats.each do |stat| %>
          <li class="list-group-item d-flex justify-content-between align-items-center text-capitalize">
            <%= stat["stat"]["name"].gsub("-", " ") %>
            <span class="badge bg-success rounded-pill"><%= stat["base_stat"] %></span>
          </li>
        <% end %>
      </ul>
    </div>

    <div class="mt-5">
      <h4 class="mb-4">Sample Moves</h4>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% @sample_moves.each do |move| %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h5 class="card-title text-capitalize">
                  <%= move[:name].gsub("-", " ") %>
                  <% if move[:damage_class] %>
                    <span class="badge bg-info text-dark text-uppercase"><%= move[:damage_class] %></span>
                  <% end %>
                </h5>

                <p class="card-text mb-1"><strong>Type:</strong> <%= move[:move_type]&.capitalize || "N/A" %></p>
                <p class="card-text mb-1"><strong>Power:</strong> <%= move[:power] || "N/A" %></p>
                <p class="card-text mb-1"><strong>Accuracy:</strong> <%= move[:accuracy] || "N/A" %></p>
                <p class="card-text mb-1"><strong>PP:</strong> <%= move[:pp] || "N/A" %></p>

                <% if move[:description].present? %>
                  <p class="card-text mt-3 text-muted"><em><%= move[:description].gsub("\n", " ") %></em></p>
                <% end %>

              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>


    <div class="mt-5">
      <h4>Abilities</h4>
      <ul>
        <% @pokemon_api["abilities"].each do |a| %>
          <li class="text-capitalize">
            <%= a["ability"]["name"].gsub("-", " ") %>
            <% if a["is_hidden"] %>
              <span class="badge bg-warning text-dark ms-1">Hidden</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>

    <div class="d-flex justify-content-center gap-3 mt-5">
      <% ["front_default", "back_default", "front_shiny", "back_shiny"].each do |sprite_key| %>
        <% sprite = @pokemon_api["sprites"][sprite_key] %>
        <% if sprite.present? %>
          <img src="<%= sprite %>" class="img-thumbnail" style="max-width: 100px;" />
        <% end %>
      <% end %>
    </div>
  </div>
<% else %>
  <div class="container py-5">
    <p class="text-danger text-center">Erro ao carregar o Pokémon. Tente novamente mais tarde.</p>
  </div>
<% end %>
